# 🧠 AIコンテキスト制限対策システム

## 🚨 コンテキストオーバーフロー問題の本質

### AIが能力低下する主な原因
1. **📏 コンテキスト長制限**: トークン数上限に達した状態
2. **🔄 情報の断片化**: 重要な情報が文脈から外れる
3. **🧩 複雑性の蓄積**: 問題が複合的になりすぎた状態
4. **🔁 同一失敗の繰り返し**: 学習効果が働かない状況
5. **💭 記憶の欠落**: 過去の知見・教訓の忘却

## 📊 コンテキスト制限の早期検知システム

### 🔍 検知トリガー（AIが自己診断する指標）

#### レベル1: 注意警報
- 会話が20回以上続いている
- 同じファイルを3回以上編集している  
- エラーメッセージを2回以上見ている
- 検索結果が徐々に的外れになっている

#### レベル2: 警戒状態
- 会話が30回以上続いている
- 同じエラーを2回経験している
- 作業効率が明らかに低下している
- ユーザーが同じ説明を繰り返している

#### レベル3: 緊急事態
- 会話が40回以上続いている
- 同一問題で3回失敗している
- 明らかに矛盾した提案をしている
- 既に解決済みの問題を再度発生させている

### 📋 自己診断チェックリスト

AIは以下を**定期的に自己評価**する：

```markdown
## コンテキスト健全性チェック

### 🧠 記憶の確認
- [ ] プロジェクトの6つのコア価値を覚えているか？
- [ ] 現在の作業目標を明確に説明できるか？
- [ ] 過去1時間の作業内容を要約できるか？
- [ ] 重要な制約・禁止事項を覚えているか？

### 🎯 問題解決能力の確認  
- [ ] 現在の問題を1文で表現できるか？
- [ ] 解決策を3つ以上思いつくか？
- [ ] 過去の失敗から学習できているか？
- [ ] 新しいアプローチを提案できるか？

### 🔄 作業効率の確認
- [ ] 直近3回の作業が順調に進んでいるか？
- [ ] 同じエラーを繰り返していないか？
- [ ] ユーザーの要求を正確に理解できているか？
- [ ] 建設的な提案ができているか？
```

## 🚨 段階的エスカレーション戦略

### フェーズ1: 自己回復の試み
```markdown
🔄 **内部リセット手順**

1. **現在状況の要約**
   - 作業目標の再確認
   - 進捗状況の整理
   - 発生中の問題の特定

2. **情報の再収集**
   - 重要ファイルの再読み込み
   - プロジェクト構造の再確認
   - 関連ドキュメントの再チェック

3. **アプローチの変更**
   - 異なる検索キーワードを使用
   - 別の解決手法を試行
   - より基本的なアプローチに立ち戻る
```

### フェーズ2: 外部リソースの活用
```markdown
🔍 **積極的な外部調査**

1. **多言語検索の実行**
   - 英語・日本語・中国語での検索
   - 異なる技術用語での検索
   - 類似問題の事例調査

2. **技術コミュニティの調査**
   - GitHub Issues/Discussions
   - Stack Overflow
   - 技術ブログ・記事

3. **公式ドキュメントの精査**
   - APIドキュメント詳細確認
   - 変更履歴・既知問題の確認
   - サンプルコード・チュートリアル
```

### フェーズ3: エスカレーション判断
```markdown
🆘 **エスカレーション基準**

以下のいずれかに該当する場合、即座にエスカレーション：

1. **同一失敗の繰り返し**
   - 同じエラーを3回経験
   - 同じ解決策を2回失敗
   - 明らかな無限ループ状態

2. **能力限界の認識**
   - 専門知識の不足を自覚
   - 複雑性が理解の範囲を超過
   - 時間効率の著しい低下

3. **リスク要因の検出**
   - データ破損の可能性
   - システム不安定化の危険
   - 回復困難な状況への進行
```

## 📝 記憶保存・移行システム

### 🗂️ セッション終了時の記憶保存

AIは作業終了時に以下を**必ず実行**：

```bash
# _history/sessions/ ディレクトリ構造
_history/
├── sessions/
│   ├── 2024-01-15_context_overflow_session.md
│   ├── 2024-01-15_build_optimization_session.md
│   └── ...
├── failures/
│   ├── error_patterns.md
│   └── solution_attempts.md
└── knowledge/
    ├── learned_solutions.md
    └── best_practices.md
```

### 📋 セッション記録テンプレート
```markdown
# セッション記録: [日付]_[主要タスク]

## 🎯 セッション概要
- **開始時刻**: YYYY-MM-DD HH:MM
- **終了時刻**: YYYY-MM-DD HH:MM  
- **主要目標**: [具体的な目標]
- **達成状況**: [完了/部分完了/未完了]

## 📊 実行した作業
### 成功した作業
- [作業1]: [結果・ファイル]
- [作業2]: [結果・ファイル]

### 失敗した作業
- [失敗1]: [エラー内容・原因・試行回数]
- [失敗2]: [エラー内容・原因・試行回数]

## 🧠 重要な発見・学習事項
- [発見1]: [詳細・適用場面]
- [発見2]: [詳細・適用場面]

## 🚨 未解決問題・課題
- [問題1]: [詳細・必要な対応]
- [問題2]: [詳細・必要な対応]

## 📋 次セッションへの申し送り
### 必須確認事項
- [確認事項1]
- [確認事項2]

### 推奨アプローチ
- [アプローチ1]: [理由]
- [アプローチ2]: [理由]

### 避けるべき手法
- [手法1]: [失敗理由]
- [手法2]: [失敗理由]
```

## 🔄 新チャット移行プロトコル

### 移行判断基準
以下の場合、新チャット移行を**積極的に提案**：

1. **コンテキスト制限近接**
   - 会話回数が35回を超過
   - トークン使用量が上限の80%に到達

2. **作業効率の著しい低下**
   - 同一問題で2時間以上停滞
   - 明らかな能力低下を自覚

3. **複雑性の過度な蓄積**
   - 複数の独立した問題が混在
   - 単一セッションでの解決が困難

### 🎯 移行時の申し送り作成

```markdown
## 新AI担当者への申し送り

### 🚀 即座に確認すべき重要事項
1. **プロジェクト基本情報**
   - `.cursor/cursor_rules.md` - 統合ルール
   - `README.md` - プロジェクト概要
   - 最新の `TODO*.md` - 作業状況

2. **現在の作業コンテキスト**
   - 目標: [具体的な目標]
   - 進捗: [現在の状況]
   - 課題: [解決すべき問題]

3. **重要な制約・注意事項**
   - [制約1]: [詳細]
   - [制約2]: [詳細]

### 📚 関連知識・過去の経験
- [知識1]: [詳細・ファイル場所]
- [知識2]: [詳細・ファイル場所]

### ⚠️ 避けるべき手法（失敗履歴）
- [失敗手法1]: [理由・詳細]
- [失敗手法2]: [理由・詳細]

### 💡 推奨アプローチ
- [アプローチ1]: [根拠・期待効果]
- [アプローチ2]: [根拠・期待効果]
```

## 🤖 別エージェント連携システム

### 専門エージェントへの依頼基準

#### 🔧 技術専門エージェント
- **C++/ROS2深層問題**: 複雑なビルドエラー・依存関係
- **AI/ML最適化**: モデル性能・推論速度改善
- **ネットワーク/ストリーミング**: 配信最適化・プロトコル設計

#### 🎨 設計専門エージェント  
- **アーキテクチャ設計**: 大規模システム構造設計
- **UX/UI設計**: インターフェース・操作性改善
- **パフォーマンス設計**: スケーラビリティ・最適化

#### 📚 ドキュメント専門エージェント
- **技術文書作成**: API仕様・設計書
- **ユーザーガイド**: 操作手順・トラブルシューティング
- **コード解説**: 複雑なロジックの説明

### 🎯 依頼時のテンプレート
```markdown
## 専門エージェントへの依頼

### 🎯 依頼内容
- **専門分野**: [技術/設計/ドキュメント]
- **具体的課題**: [詳細な問題説明]
- **期待する成果**: [具体的なアウトプット]

### 📋 提供情報
- **プロジェクト情報**: FluentVision ROS2 (便利・楽・簡単・スムース・高速・美しい)
- **技術スタック**: ROS2 Humble, C++17, Intel RealSense, YOLOv10
- **関連ファイル**: [ファイルパス一覧]
- **制約条件**: [重要な制約・制限]

### 🚫 これまでの失敗事例
- [失敗1]: [詳細・原因]
- [失敗2]: [詳細・原因]

### 💡 試行済みアプローチ
- [アプローチ1]: [結果]
- [アプローチ2]: [結果]
```

---

**🌟 コンテキスト管理の哲学**: AIの限界を謙虚に受け入れ、適切なタイミングで記憶を保存し、新しい知性と協力することで、継続的に高品質なソリューションを提供する。「Flow Like Water」は、必要に応じて器を変えることも含む。
