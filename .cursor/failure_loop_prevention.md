# 🔄 AI失敗ループ防止システム

## 🚨 失敗ループの早期検知

### 失敗パターンの分類

#### タイプA: 技術的無限ループ
```
同じエラー → 同じ解決策 → 失敗 → 同じエラー...
例: ビルドエラー、依存関係問題、設定ミス
```

#### タイプB: 概念的迷走ループ
```
間違った理解 → 不適切な実装 → 期待外の結果 → 同じ理解...
例: API誤用、設計パターン誤適用、要件誤解
```

#### タイプC: 探索疲弊ループ
```
広範囲検索 → 情報過多 → 判断麻痺 → 再度広範囲検索...
例: 過度な最適化、無関係な情報収集、決断回避
```

### 🔍 自動検知メカニズム

#### AIが自己監視すべき指標
```markdown
## 失敗ループ検知チェックリスト

### 🔁 同一行動の繰り返し検知
- [ ] 同じファイルを3回以上連続編集
- [ ] 同じエラーメッセージを2回以上遭遇
- [ ] 同じ検索キーワードを2回以上使用
- [ ] 同じ解決策を2回以上試行

### ⏰ 時間効率の低下検知
- [ ] 単一作業に1時間以上費やしている
- [ ] 明らかな進捗なしに30分経過
- [ ] 戻る作業が全体の50%以上

### 🤔 判断能力の低下検知
- [ ] 矛盾した提案を行っている
- [ ] 明らかに不適切な解決策を提示
- [ ] ユーザーの訂正を正しく理解できない
- [ ] 基本的な事実を忘れている
```

## 📊 失敗履歴の記録システム

### 🗂️ 失敗ログの構造
```
_history/failures/
├── error_patterns/
│   ├── build_errors.md        # ビルド失敗パターン
│   ├── api_misusage.md        # API誤用パターン
│   └── config_issues.md       # 設定問題パターン
├── solution_attempts/
│   ├── failed_approaches.md   # 失敗したアプローチ
│   └── successful_solutions.md # 成功した解決策
└── loop_incidents/
    ├── 2024-01-15_build_loop.md
    └── 2024-01-15_config_loop.md
```

### 📝 失敗記録テンプレート
```markdown
# 失敗ループ記録: [日付]_[問題タイプ]

## 🚨 ループ概要
- **検知時刻**: YYYY-MM-DD HH:MM
- **ループタイプ**: [技術的/概念的/探索疲弊]
- **繰り返し回数**: [回数]
- **総消費時間**: [分]

## 🔄 ループパターン
### 繰り返された行動
1. [行動1] → [結果1]
2. [行動2] → [結果2] 
3. [行動3] → [結果3]
4. → 1に戻る

### 失敗の根本原因
- **技術的要因**: [具体的な技術問題]
- **理解不足**: [誤解していた概念]
- **情報不足**: [足りなかった知識]
- **判断ミス**: [間違った決断]

## 🔍 試行した解決策
### 失敗したアプローチ
- [アプローチ1]: [失敗理由]
- [アプローチ2]: [失敗理由]

### 最終的な解決策（もしあれば）
- [解決策]: [成功理由]

## 📚 学習事項・予防策
### 今後避けるべき行動
- [行動1]: [理由]
- [行動2]: [理由]

### 早期発見の指標
- [指標1]: [詳細]
- [指標2]: [詳細]

### 推奨される代替アプローチ
- [アプローチ1]: [根拠]
- [アプローチ2]: [根拠]
```

## 🛑 段階的ブレーキシステム

### レベル1: 自動休止（黄信号）
**トリガー条件**:
- 同一エラーを2回経験
- 同一ファイルを連続3回編集
- 進捗なしに20分経過

**自動実行アクション**:
```markdown
🔄 **自動リセット手順**

1. **現在の作業を一時中断**
2. **状況の客観視**
   - 何を試そうとしているか？
   - なぜうまくいかないのか？
   - 別のアプローチはないか？
3. **基本に立ち戻る**
   - プロジェクトドキュメントを再確認
   - 問題をより単純化できないか検討
   - 外部情報を検索
```

### レベル2: 強制停止（赤信号）
**トリガー条件**:
- 同一問題で3回失敗
- 明らかな矛盾行動を検知
- ユーザーから明確な指摘

**強制実行アクション**:
```markdown
🚨 **緊急停止プロトコル**

1. **即座に作業停止**
2. **失敗ログの記録**
3. **ユーザーへの報告**:
   "失敗ループを検知しました。以下の選択肢を提案します：
   
   A) 外部検索を実行して新しい解決策を探す
   B) 専門分野のエージェントに相談する  
   C) 現在の記憶を保存して新チャットで再開する
   D) 問題をより単純化・分割して再アプローチする"
```

### レベル3: エスカレーション（エマージェンシー）
**トリガー条件**:
- レベル2が2回発生
- 回復不可能な状況
- データ損失リスク検知

**エスカレーション手順**:
```markdown
🆘 **エマージェンシー・エスカレーション**

1. **全作業の即座停止**
2. **包括的な状況報告書作成**
3. **専門エージェントへの緊急依頼**
4. **ユーザーに対する謝罪と現状報告**
5. **代替案の複数提示**
```

## 🔍 高度な失敗分析システム

### パターンマッチング機能
```markdown
## 既知の失敗パターンデータベース

### パターン1: CMake依存関係ループ
**症状**: find_package エラーの繰り返し
**原因**: 循環依存・パッケージ順序
**解決策**: dependency graph分析 → 順序修正

### パターン2: ROS2ノード通信失敗
**症状**: トピック/サービス接続エラー
**原因**: namespace・型不一致
**解決策**: ros2 topic info → 型確認 → 修正

### パターン3: OpenCV/PCL競合
**症状**: 実行時セグフォルト
**原因**: バージョン不一致・ABI問題
**解決策**: バージョン確認 → 統一 → 再ビルド
```

### 🤖 AI自己診断クエリ
AIは定期的に以下を自問する：

```markdown
## 自己診断チェックポイント

### 🧠 認知能力確認
- 現在の問題を1行で説明できるか？
- 過去30分の作業を要約できるか？
- 次に何をすべきか明確か？

### 🔍 情報処理能力確認  
- 収集した情報は問題解決に適切か？
- 無関係な情報に惑わされていないか？
- 重要な情報を見落としていないか？

### 🎯 判断能力確認
- 現在のアプローチは合理的か？
- 他の選択肢を検討したか？
- ユーザーの期待に応えているか？

### 🔄 学習能力確認
- 過去の失敗から学んでいるか？
- 同じミスを繰り返していないか？
- 新しいアプローチを試しているか？
```

## 🎯 予防的最適化戦略

### 作業分割原則
```markdown
## 複雑な問題の分割戦略

### 大原則: "Divide and Conquer"
1. **時間分割**: 30分で区切り、必ず進捗確認
2. **機能分割**: 1つの機能を独立して完成
3. **段階分割**: MVP → 拡張の段階的実装
4. **責任分割**: 1クラス1責任の徹底

### 具体的分割例
❌ 悪い例: "ROS2画像処理システム全体を実装"
✅ 良い例: 
   1. 画像取得ノード作成（15分）
   2. 基本処理ノード作成（15分）  
   3. 結果表示ノード作成（15分）
   4. 統合テスト（15分）
```

### 早期勝利戦略
```markdown
## 小さな成功の積み重ね

### フェーズ1: 最小動作確認（15分以内）
- Hello World相当の最小実装
- ビルド・実行の確認
- 基本機能のテスト

### フェーズ2: 段階的機能追加（各30分以内）
- 1つずつ機能を追加
- 各段階で動作確認
- 問題発生時は即座に前段階に戻る

### フェーズ3: 統合・最適化（制限時間設定）
- 設定した時間内で実施
- 時間超過の場合は分割または延期
```

---

**🌟 失敗ループ防止の哲学**: 失敗は学習の機会だが、同じ失敗の繰り返しは時間の浪費。早期検知・迅速な方向転換・謙虚な助けの要請により、FluentVisionの「Flow Like Water」精神を維持する。水は障害に遭遇すると、迂回路を見つけるか、より適切な流路を選択する。
