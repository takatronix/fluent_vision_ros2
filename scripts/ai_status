#!/bin/bash

# =============================================================================
# Fluent Vision - AIãƒãƒ¼ãƒ‰çŠ¶æ…‹ç¢ºèªã‚³ãƒãƒ³ãƒ‰
# =============================================================================
# 
# æ¦‚è¦ï¼š
#   - AIãƒãƒ¼ãƒ‰ï¼ˆUNet + YOLOï¼‰ã®å®Ÿè¡ŒçŠ¶æ…‹ã‚’ç¢ºèª
#   - ã‚«ãƒ¡ãƒ©åˆ¥ã®ãƒãƒ¼ãƒ‰çŠ¶æ…‹ã‚’è¡¨ç¤º
#
# ä½¿ç”¨æ–¹æ³•ï¼š
#   ./ai_status [d415|d405|both]
#   
#   ä¾‹ï¼š
#   ./ai_status d415    # D415ã®AIãƒãƒ¼ãƒ‰çŠ¶æ…‹ã‚’ç¢ºèª
#   ./ai_status d405    # D405ã®AIãƒãƒ¼ãƒ‰çŠ¶æ…‹ã‚’ç¢ºèª
#   ./ai_status both    # å…¨AIãƒãƒ¼ãƒ‰çŠ¶æ…‹ã‚’ç¢ºèª
#
# ä½œè€…ï¼šTakashi Otsuka
# ä½œæˆæ—¥ï¼š2024å¹´
# ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼š1.0
# =============================================================================

# è‰²ä»˜ããƒ­ã‚°å‡ºåŠ›é–¢æ•°
log_info() {
    echo -e "\033[32m[INFO]\033[0m $1"
}

log_warn() {
    echo -e "\033[33m[WARN]\033[0m $1"
}

log_error() {
    echo -e "\033[31m[ERROR]\033[0m $1"
}

# ãƒ˜ãƒ«ãƒ—è¡¨ç¤º
show_help() {
    echo "Fluent Vision AIãƒãƒ¼ãƒ‰çŠ¶æ…‹ç¢ºèªã‚³ãƒãƒ³ãƒ‰"
    echo ""
    echo "ä½¿ç”¨æ–¹æ³•:"
    echo "  $0 [d415|d405|both]"
    echo ""
    echo "ã‚«ãƒ¡ãƒ©:"
    echo "  d415     - RealSense D415ã®AIãƒãƒ¼ãƒ‰çŠ¶æ…‹ã‚’ç¢ºèª"
    echo "  d405     - RealSense D405ã®AIãƒãƒ¼ãƒ‰çŠ¶æ…‹ã‚’ç¢ºèª"
    echo "  both     - å…¨AIãƒãƒ¼ãƒ‰çŠ¶æ…‹ã‚’ç¢ºèª"
    echo ""
    echo "ä¾‹:"
    echo "  $0 d415     # D415ã®AIãƒãƒ¼ãƒ‰çŠ¶æ…‹ã‚’ç¢ºèª"
    echo "  $0 d405     # D405ã®AIãƒãƒ¼ãƒ‰çŠ¶æ…‹ã‚’ç¢ºèª"
    echo "  $0 both     # å…¨AIãƒãƒ¼ãƒ‰çŠ¶æ…‹ã‚’ç¢ºèª"
}

# ãƒãƒ¼ãƒ‰çŠ¶æ…‹ç¢ºèªé–¢æ•°
check_node_status() {
    local node_name=$1
    local node_display_name=$2
    
    if pgrep -f "$node_name" > /dev/null; then
        echo -e "  âœ… $node_display_name: \033[32må®Ÿè¡Œä¸­\033[0m"
        return 0
    else
        echo -e "  âŒ $node_display_name: \033[31måœæ­¢ä¸­\033[0m"
        return 1
    fi
}

# ã‚«ãƒ¡ãƒ©åˆ¥çŠ¶æ…‹ç¢ºèª
check_camera_status() {
    local camera=$1
    
    case $camera in
        "d415")
            echo "ğŸ“· D415 AIãƒãƒ¼ãƒ‰çŠ¶æ…‹:"
            check_node_status "fv_object_mask_generator_d415" "UNet (ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³)"
            check_node_status "fv_object_detector_d415" "YOLO (ç‰©ä½“æ¤œå‡º)"
            ;;
        "d405")
            echo "ğŸ“· D405 AIãƒãƒ¼ãƒ‰çŠ¶æ…‹:"
            check_node_status "fv_object_mask_generator_d405" "UNet (ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³)"
            check_node_status "fv_object_detector_d405" "YOLO (ç‰©ä½“æ¤œå‡º)"
            ;;
        "both")
            echo "ğŸ“· D415 AIãƒãƒ¼ãƒ‰çŠ¶æ…‹:"
            check_node_status "fv_object_mask_generator_d415" "UNet (ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³)"
            check_node_status "fv_object_detector_d415" "YOLO (ç‰©ä½“æ¤œå‡º)"
            echo ""
            echo "ğŸ“· D405 AIãƒãƒ¼ãƒ‰çŠ¶æ…‹:"
            check_node_status "fv_object_mask_generator_d405" "UNet (ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³)"
            check_node_status "fv_object_detector_d405" "YOLO (ç‰©ä½“æ¤œå‡º)"
            ;;
        *)
            log_error "ç„¡åŠ¹ãªã‚«ãƒ¡ãƒ©: $camera"
            show_help
            exit 1
            ;;
    esac
}

# ãƒ¡ã‚¤ãƒ³å‡¦ç†
main() {
    local camera=${1:-"both"}
    
    # å¼•æ•°ãƒã‚§ãƒƒã‚¯
    if [[ $# -gt 1 ]]; then
        log_error "å¼•æ•°ãŒå¤šã™ãã¾ã™"
        show_help
        exit 1
    fi
    
    # ã‚«ãƒ¡ãƒ©ã®æ¤œè¨¼
    case $camera in
        "d415"|"d405"|"both") ;;
        *)
            log_error "ç„¡åŠ¹ãªã‚«ãƒ¡ãƒ©: $camera"
            show_help
            exit 1
            ;;
    esac
    
    log_info "AIãƒãƒ¼ãƒ‰çŠ¶æ…‹ç¢ºèªé–‹å§‹: $camera"
    check_camera_status "$camera"
    log_info "AIãƒãƒ¼ãƒ‰çŠ¶æ…‹ç¢ºèªå®Œäº†"
}

# ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ
if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
    main "$@"
fi 